# (POC) Tactical Auto-Action RPG — Phaser 4 기반 개발 기획서
- 목표: 그래픽 에셋 없이(도형/텍스트만) “전략 4버튼 + 자동 전투 + 런 종료 후 행동 기반 성장(런 한정) + 기록만 남김”이 재미로 성립하는지 검증
- 엔진: Phaser 4 (RC/베타 채널 사용)
- 플랫폼: Web (Desktop + Mobile Touch 대응)
- 세션: 1회 120~180초 (인스턴트 런)

──────────────────────────────────────────────────────────────────────────────
0. 핵심 컨셉 / 게임 정체성
──────────────────────────────────────────────────────────────────────────────
장르: Tactical Auto-Action RPG (전술 선택형 자동 액션)
한 줄:
  "플레이어는 전략만 고른다. 요원(Agent)은 전략대로 스스로 싸운다.
   런 동안의 선택/행동 로그가 런 종료 시 자동 성장(런 한정)으로 반영된다."

제약(명확한 차별점):
- 이동/조준/에임/타이밍 조작 없음
- 카드/웨이브 선택 없음
- 성장 = 런 종료 후 일괄 적용, 다음 런에는 리셋(진정한 인스턴트 런)
- 페널티 = 성장/재화 손실 없음 (B: 기록만 남김)

세계관 톤(POC에서는 텍스트로만 표현):
- 다크 사이버펑크 스트리트 / 네온 / 불법구역 / 요원 / 드론 / 갱단 / 실험체

──────────────────────────────────────────────────────────────────────────────
1. POC 목표 / 성공 기준
──────────────────────────────────────────────────────────────────────────────
POC 목표(2주 내 구현 가능 수준):
1) 전투 중 플레이어 입력은 "전략 버튼 4개"만 존재한다.
2) 전략에 따라 요원 AI가 이동/타깃/스킬 사용을 자동으로 수행한다.
3) 런 종료 시 텔레메트리(행동 로그) 기반으로 "런 한정 특성"이 자동 부여되고,
   결과 요약 화면에서 "왜 이런 특성이 생겼는지" 인과를 보여준다.
4) 패널티는 "기록"만 남는다(도감/통계). 다음 런은 동일 조건으로 재시작.

성공 기준(정성/정량):
- (정성) 사용자가 3판 이상 “한 판 더”를 스스로 누른다.
- (정성) 사용자 피드백에서 “버튼 4개로 판단하는 재미”가 언급된다.
- (정량) 평균 런 길이 90~180초 내 수렴.
- (정량) 버튼 사용이 특정 1개에 쏠리지 않고 상황별 분산(POC 단계에서 완벽 불필요).

──────────────────────────────────────────────────────────────────────────────
2. 기술 스택 / 프로젝트 셋업
──────────────────────────────────────────────────────────────────────────────
언어/번들러:
- TypeScript
- Vite
- Phaser 4 (RC/베타)

설치(권장):
- npm create vite@latest tac-auto-rpg-poc -- --template vanilla-ts
- npm i phaser@4.0.0-rc.6
  (또는 실험적 최신이 필요하면 phaser@beta 사용)

런/빌드:
- npm run dev
- npm run build
- npm run preview

코딩 에이전트 작업 단위(커밋 기준):
- C1: 프로젝트 스캐폴딩 + Phaser 부팅 + 기본 씬 렌더
- C2: 입력(UI) 4버튼 + 모바일 터치 지원
- C3: Agent + Enemy 최소 전투(충돌/피해/사망)
- C4: 전략 기반 AI 상태머신(Engage/Guard/Evade/Burst)
- C5: 텔레메트리 수집 + 런 종료 요약 화면
- C6: 성장(런 한정 특성) 적용 + 체감 가능한 효과 6개
- C7: 난이도/적 패턴 3종 + 환경 위험 1종
- C8: 디버그 오버레이(상태/로그/밸런스 값) + 튜닝

──────────────────────────────────────────────────────────────────────────────
3. 파일/폴더 구조(권장)
──────────────────────────────────────────────────────────────────────────────
src/
  main.ts
  game/
    config.ts
    constants.ts
    scenes/
      BootScene.ts
      BattleScene.ts
      SummaryScene.ts
    ui/
      StrategyBar.ts
      Hud.ts
      DebugOverlay.ts
    entities/
      Agent.ts
      Enemy.ts
      EnemyFactory.ts
    ai/
      Strategy.ts
      AgentAI.ts
      ThreatModel.ts
      Steering.ts
    systems/
      CombatSystem.ts
      Telemetry.ts
      RunTimer.ts
      GrowthResolver.ts
      RunRecorder.ts
    data/
      balance.ts
      growthTraits.ts
      enemyArchetypes.ts

POC 원칙:
- 에셋 없음: Graphics(도형), BitmapText/DOMText(텍스트)만 사용
- Physics는 단순하게(원형/사각 충돌) — 복잡한 물리 X

──────────────────────────────────────────────────────────────────────────────
4. 게임 루프 / 씬 흐름
──────────────────────────────────────────────────────────────────────────────
BootScene:
- 화면 크기/스케일 설정
- 폰트(기본), 색상 팔레트 상수 초기화
- BattleScene으로 이동

BattleScene:
- 런 시작(타이머 120~180초)
- Agent 1명 스폰, Enemy 웨이브/스폰
- UI: 전략 버튼 4개 + 현재 전략/쿨다운/HP 표시
- 텔레메트리 기록
- 종료 조건:
  A) 타이머 완료 = 클리어
  B) Agent HP 0 = 실패
- 종료 시 SummaryScene으로 데이터 전달

SummaryScene:
- 전술 프로필 판정(예: 회피 반격형/돌진 공격형/방어 통제형)
- 런 한정 특성(트레잇) 일괄 부여 결과 표시
- “왜 생겼는지” 지표 요약
- 버튼: [재시작] (기록은 RunRecorder에 저장)

──────────────────────────────────────────────────────────────────────────────
5. 입력/UI 설계 (전략 버튼 4개)
──────────────────────────────────────────────────────────────────────────────
전략 버튼:
1) Engage (돌진)
2) Guard (방어)
3) Evade (회피)
4) Burst (집중 공격)

입력 방식:
- 클릭/터치: 버튼 누르면 즉시 "현재 전략"이 변경
- 키보드(테스트용): 1~4로 전략 변경
- 전략 변경은 "쿨다운"을 가질 수 있음(POC에서 옵션):
  - 기본: 변경 즉시 가능
  - 실험: 전략 변경 쿨다운 0.5s (스팸 방지)

UI 요소(POC):
- 상단: 타이머, Agent HP, 현재 전략 라벨
- 하단: 4버튼(큰 히트박스) + 각 버튼 쿨다운/리스크 아이콘(텍스트/색)
- 디버그 오버레이(토글 D):
  - Agent 상태, 타깃, 위협도, 텔레메트리 실시간 수치
  - 현재 적용된 트레잇 목록(런 후반 체감 실험용)

──────────────────────────────────────────────────────────────────────────────
6. 엔티티 설계 (Agent / Enemy)
──────────────────────────────────────────────────────────────────────────────
6.1 Agent(요원)
필수 상태:
- position (x,y), velocity (x,y)
- hp, maxHp
- stamina/energy (옵션: 대시/버스트 자원)
- attack cooldowns (basic, special)
- currentStrategy (Engage/Guard/Evade/Burst)
- traits (런 한정 특성 배열)

전투 능력(POC 최소):
- Basic Attack:
  - 근접 원형 범위(반경 R)
  - 쿨다운 0.6s
  - 피해 D
- Special(전략별 파생):
  - Engage: 돌진 타격(짧은 이동 + 넉백)
  - Guard: 방어 상태(피해 감소 + 넉백 저항)
  - Evade: 대시(짧은 무적 프레임)
  - Burst: 집중 사격/연타(짧은 시간 공격속도↑, 이후 피로 패널티)

6.2 Enemy(적)
적 아키타입(POC 3종):
- Rusher(근접 돌진): Agent에게 직선 접근 + 근접 타격
- Sniper(원거리): 거리 유지 + 투사체 발사(단순 직선)
- Elite(보스/엘리트): 차지 공격(텔레그래프) + 소환(옵션)

공통 상태:
- hp, speed, damage, range
- archetypeId
- behaviorTick() (아키타입별 AI)

──────────────────────────────────────────────────────────────────────────────
7. 전술 기반 AI (핵심)
──────────────────────────────────────────────────────────────────────────────
구성:
- AgentAI = 상태머신(FSM) + ThreatModel + Steering(이동/회피 벡터)
- 플레이어 입력은 FSM의 "정책(Policy)"를 바꾸는 역할

7.1 ThreatModel(위협도 계산)
목적: 현재 전장 상황을 수치화하여 "무엇을 우선 처리/회피"할지 결정
입력:
- 주변 적 목록(거리, DPS, 현재 공격 텔레그래프 상태, 체력)
출력:
- primaryThreat (가장 위협도 높은 적)
- threatScoreMap (enemyId -> score)

예시 스코어:
score = w1*(enemyDPS) + w2*(telegraphingCharge?)+ w3*(distanceFactor) + w4*(enemyIsSniper?) - w5*(enemyHpLow?)

7.2 Steering(자동 이동)
목적: 전략별로 다른 이동 방식을 제공(접근/유지/이탈)
- seek(targetPos)
- flee(threatPos)
- orbit(targetPos, radius)
- dodge(projectileVector) (POC에서는 단순화 가능)

7.3 AgentAI FSM(전략별)
각 전략은 "우선순위 큐"처럼 동작:

[Engage]
- primaryThreat 선정(보통 Sniper/Elite 우선)
- 접근 -> 돌진 스킬(가능하면) -> 근접 기본공격 반복
- HP가 임계치 이하이면 Guard로 "권고" 표시(자동 전환 X, UX 실험 가능)

[Guard]
- 위협 방향을 향해 방어
- 근접 적이 많으면 후퇴(flee) + 방어 유지
- 투사체/차지 텔레그래프 감지 시 Guard 강화(피해 감소/경직 저항)
- 공격은 최소(방어 중 반격 룰: 특정 조건에서만 기본공격)

[Evade]
- 텔레그래프(차지) 또는 투사체 위협이 높을 때 최우선 회피
- 회피 후 "안전 거리" 재확보(orbit/flee)
- 회피 직후 0.8s 동안 반격 우선(기본공격/짧은 돌진)

[Burst]
- primaryThreat에 거리 최적화(너무 가까우면 이격, 너무 멀면 접근)
- burstWindow 동안 공격속도/피해 증가(예: 1.5s)
- burst 후 피로(attack cooldown 증가 or 이동 속도 감소) 1.0s

POC 단순화 규칙(중요):
- “완벽한 AI”가 목표가 아니다.
- 전략별 ‘행동 성향’이 명확히 체감되면 성공.

──────────────────────────────────────────────────────────────────────────────
8. 전투 시스템(CombatSystem) / 판정
──────────────────────────────────────────────────────────────────────────────
피해/충돌:
- 도형 기반 충돌(원/사각)
- 근접 공격: Agent 위치 중심 원형 히트(범위 안 적에게 피해)
- 투사체: 단순 직선 이동, Agent와 충돌 시 피해

상태 효과(POC 선택):
- Knockback(넉백): Engage 스킬에서만 사용
- DamageReduction(피해감소): Guard 상태에서만 사용
- InvulnFrames(무적): Evade 대시에만 사용

런 타이머:
- 120초 기본(밸런스 파일에서 조정)
- 90초~180초 범위 튜닝

──────────────────────────────────────────────────────────────────────────────
9. 텔레메트리(행동 로그) & 기록(패널티 B)
──────────────────────────────────────────────────────────────────────────────
9.1 Telemetry 수집 항목(최소)
전략 사용:
- strategyTime[Engage/Guard/Evade/Burst] (각 전략 유지 시간)
- strategySwitchCount
생존/위험:
- timeBelowHp30
- hitsTakenCount
- damageTakenTotal
회피:
- evadeCount
- evadeSuccessCount (회피 직후 0.5s 내 피격 없으면 성공)
공격:
- damageDealtTotal
- killsByArchetype (Rusher/Sniper/Elite)
- burstActivations
가치 판단(POC):
- "sniperKillTimeAvg" (스나이퍼를 얼마나 빨리 처리했나)

9.2 RunRecorder(영구 기록)
- 최근 N회 런 요약(로컬스토리지 저장)
- 누적 통계(전술 프로필 분포, 평균 생존 시간 등)
- 도감(처치한 적 타입 체크)

주의:
- 성장/트레잇은 런 한정이므로 저장하지 않음
- 저장하는 건 "기록"만(B 패널티)

──────────────────────────────────────────────────────────────────────────────
10. 성장 시스템(런 종료 후 일괄 적용) — GrowthResolver
──────────────────────────────────────────────────────────────────────────────
입력: TelemetrySummary
출력:
- playstyleProfile (예: "Dodge-Counter", "Aggro-Burst", "Shield-Control")
- grantedTraits[] (트레잇 2~4개)
- explanation[] (지표 기반 문장/숫자)

10.1 프로필 판정(스코어링)
각 프로필에 대해 score를 계산하고 최고값 선택:

score_dodge =
  a1*(evadeSuccessRate) + a2*(timeBelowHp30 negative?) + a3*(hitsTakenInverse)

score_aggression =
  b1*(strategyTimeEngage + strategyTimeBurst) + b2*(damageDealtTotal) + b3*(sniperKills)

score_defense =
  c1*(strategyTimeGuard) + c2*(damageTakenTotal inverse) + c3*(timeAlive)

POC는 단순 가중치로 시작하고, 디버그 오버레이로 튜닝 가능하게 한다.

10.2 트레잇(POC 6개, 각 프로필 2개씩)
(런 후반부 체감을 위해, 트레잇 효과는 “적당히 강하게”)
- Dodge 계열:
  T1 PhantomTrace: Evade 후 1.0s 피해 -50%
  T2 ReflexBurst: Evade 후 첫 공격 피해 +40%
- Aggro 계열:
  T3 OverclockCharge: Engage 돌진 거리 +25%, 넉백 +20%
  T4 BloodExchange: 피해량의 3% 흡혈
- Defense 계열:
  T5 AdaptiveShield: Guard 중 stamina regen +X / 또는 Guard 지속시간 증가
  T6 ThreatRedirect: Sniper 위협도 가중치 감소(= AI가 더 빨리 스나이퍼를 잡도록 유도)

트레잇 적용 타이밍:
- 런 종료 직후 SummaryScene에서 부여
- “POC 실험 옵션”: ‘다음 재도전’ 시에만 적용하는 모드도 스위치로 제공(비교 실험)

10.3 설명 생성(인과 UX)
예:
- "회피 성공률 78% (11/14) → 회피-반격 트레잇 부여"
- "Guard 유지 46초, 총 피해 120 → 방어-통제 트레잇 부여"

──────────────────────────────────────────────────────────────────────────────
11. 전투 밸런스(초기값, POC)
──────────────────────────────────────────────────────────────────────────────
(모두 data/balance.ts로 분리, 디버그 UI로 즉시 조정 가능)

Agent:
- maxHp: 100
- baseDamage: 10
- basicCooldown: 0.6s
- moveSpeed: 140
- engageDashSpeed: 420 (0.18s)
- evadeDashSpeed: 520 (0.14s + i-frames 0.12s)
- guardDamageReduction: 50%

Enemies:
- Rusher: hp 25, speed 120, dmg 8, range 18
- Sniper: hp 18, speed 80, dmg 12, projectileSpeed 300, range 220
- Elite: hp 120, speed 90, dmg 18, chargeTelegraph 0.8s, chargeSpeed 520

스폰:
- 0~30s: Rusher 위주 (학습 구간)
- 30~70s: Sniper 혼합 (판단 요구)
- 70~120s: Elite 등장 + 혼합 (최종 테스트)

환경 위험(1종):
- ElectricBarrier: 고정 라인(시각적으로 네온 라인), 접촉 시 초당 20 피해
  -> Evade/Guard 전략에서 이득이 생기도록 배치

──────────────────────────────────────────────────────────────────────────────
12. 디버그 / 튜닝 도구(POC 필수)
──────────────────────────────────────────────────────────────────────────────
DebugOverlay 기능:
- 현재 전략/AI 상태(FSM state)
- primaryThreat 및 threatScore 상위 3개 표시
- Telemetry 실시간 수치
- 프로필 점수(score_dodge/aggression/defense)
- 현재 밸런스 값 실시간 표시(선택적으로 슬라이더)

키:
- D: 디버그 토글
- R: 런 리스타트
- 1~4: 전략 변경(테스트)

──────────────────────────────────────────────────────────────────────────────
13. 개발 체크리스트(에이전트용)
──────────────────────────────────────────────────────────────────────────────
[필수 POC]
- [ ] Phaser 4 부팅 + 화면 스케일 대응(모바일 리사이즈)
- [ ] BattleScene: Agent/Enemy 스폰 + 기본 렌더(도형)
- [ ] StrategyBar: 4버튼 + 입력 이벤트 + 현재전략 표시
- [ ] AgentAI FSM: Engage/Guard/Evade/Burst 구현
- [ ] CombatSystem: 근접/투사체 피해 + HP + 사망
- [ ] Telemetry: 전략 시간/회피 성공/피격/딜/킬 기록
- [ ] SummaryScene: 프로필 판정 + 트레잇 2~4개 부여 + 설명 출력
- [ ] RunRecorder: localStorage에 기록 저장(최근 N회 + 누적)
- [ ] DebugOverlay: 상태/스코어/로그 노출

[옵션]
- [ ] 전략 변경 쿨다운(스팸 방지)
- [ ] 사운드(POC에서는 비활성 가능)
- [ ] 간단한 화면 흔들림/플래시(피격 피드백)

──────────────────────────────────────────────────────────────────────────────
14. POC 이후 확장 아이디어(참고)
──────────────────────────────────────────────────────────────────────────────
- 전략 버튼은 4개 고정, 대신 "트레잇이 AI 내부 파생 행동"을 확장:
  - Engage 파생: 측면 돌진, 스나이퍼 우선 추적, 다수 넉백
  - Guard 파생: 투사체 반사(확률), 광역 방어막
  - Evade 파생: 완벽 회피 시 시간감속(짧게)
  - Burst 파생: 약점 표식, 연사 후 폭발

- 적 패턴을 “판단 퍼즐”로:
  - 회피 봉쇄 드론, 방어 파괴자, 유인형 적 등

- 세계관/연출 강화:
  - 런 시작/종료 텍스트 카드, 네온 UI, 로그 스타일

──────────────────────────────────────────────────────────────────────────────
15. 산출물(POC 완료 시 기대 결과)
──────────────────────────────────────────────────────────────────────────────
- 로컬에서 즉시 실행 가능한 웹 POC
- 한 판 2분 내외, 버튼 4개로 전략적 재미 확인
- 종료 요약에서 "내 플레이가 곧 빌드"라는 인과를 명확히 체감
- 기록(통계/도감)만 축적되어 반복 플레이 유도

끝.

